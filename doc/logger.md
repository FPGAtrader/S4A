# S4A logger
## spdlog
* 本项目的日志是在[spdlog](https://github.com/gabime/spdlog)上进行的封装，实现了一个单例全局异步日志类。
* 预定义了若干宏用于打印日志，日志代码形式类似于```python```的```.format()```格式。
* 在代码中可以动态开关日志输出位置、日志等级、日志文件保存目录、日志文件名前缀。

## 固定五个日志输出位

* 包括：
    * 控制台
    * 带时间戳的通用日志文件
    * 不带时间戳的通用日志文件
    * 带时间戳的错误日志文件
    * 不带时间戳的错误日志文件

* 每个输出位置都可以单独开关；控制台和通用日志文件可以分别独立设置日志等级；错误日志固定等级为error。

* 其中带时间戳的日志文件主要用于实盘，便于分析时间点；不带时间戳的日志文件主要用于回测，便于比较日志。


## 两种日志模块

### 全局模块 global 

* 输出的日志固定以```[global]```标识。

* 任何包含了```"common/s4logger.h"```的代码都可以直接调用全局模块来输出日志，以下宏用于输出全局日志：

    * TRACE()
    * INFO()
    * WARN()
    * ERR()
    * FATAL()

### 本地模块 local

* 在包含了```"common/s4logger.h"```的.cpp文件中，采用宏```#define __LCL_NAME__ "xxx"```则可以定义一个本地日志标识，在此文件中输出的日志均带有```[xxx]```标识。

* 以下宏用于输出本地日志：

    * LCL_TRACE()
    * LCL_INFO()
    * LCL_WARN()
    * LCL_ERR()
    * LCL_FATAL()

* 必须先定义宏```#define __LCL_NAME__ "xxx"```定义本地日志标识后，才能在代码中使用LCL_xxx()输从本地日志。


## spdlog的异步日志模式

* 本项目日志完全采用spdlog的异步日志(mt)模式。

* 在mt模式下，spdlog有一个独立线程用于输出日志，需要输出日志的工作线程和日志线程间采用有锁队列的方式交互。

* 工作线程构造日志string对象并丢给日志线程的有锁队列；之后唤起spdlog日志线程。

* spdlog线程在取到日志数据后，往预先定义好的若干日志位置（控制台、文件）输出日志。

## 日志示例和测试

* [/test/test_logger.cpp](/test/test_logger.cpp)
